<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>interheart</title>
  <link rel="stylesheet" href="/static/app.css?v={{ ui_version }}">
</head>

<body>
  <div class="toasts" id="toasts"></div>

  <!-- Logs modal -->
  <div class="modal" id="logModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Logs">
      <div class="modal-head">
        <div class="modal-title">
          <b>Logs</b>
          <span>Last <span id="logLinesLbl">{{ log_lines }}</span> lines</span>
        </div>
        <div class="modal-actions">
          <input id="logFilter" class="input input--sm" placeholder="filter (e.g. anl-0161)">
          <button class="btn btn-ghost btn-mini" id="btnReloadLogs" type="button">Reload</button>
          <button class="btn btn-ghost btn-mini" id="btnCopyLogs" type="button">Copy</button>
          <button class="btn btn-ghost btn-mini" id="btnCloseLogs" type="button">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="logbox" id="logBox">Loading logs…</div>
        <div class="hint" id="logMeta">-</div>
      </div>
      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <!-- Run modal -->
  <div class="modal" id="runModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Run summary">
      <div class="modal-head">
        <div class="modal-title">
          <b>Run</b>
          <span id="runTitleMeta">-</span>
        </div>
        <div class="modal-actions">
          <div class="run-live" id="runLive" style="display:none;">
            <span class="pulse"></span>
            <span id="runLiveText">Running…</span>
          </div>
          <button class="btn btn-ghost btn-mini" id="btnCloseRun" type="button">Close</button>
        </div>
      </div>

      <div class="modal-body">
        <div class="summary-wrap">
          <div class="metric"><b>Total</b><div class="v" id="mTotal">-</div></div>
          <div class="metric"><b>Checked</b><div class="v" id="mDue">-</div></div>
          <div class="metric"><b>Skipped</b><div class="v" id="mSkipped">-</div></div>
          <div class="metric"><b>Ping OK</b><div class="v" id="mOk">-</div></div>
          <div class="metric"><b>Ping fail</b><div class="v" id="mFail">-</div></div>
        </div>

        <div class="metric">
          <b>Progress</b>
          <div class="bar"><div id="runBar"></div></div>
          <div class="summary-sub">
            <span id="runNowLine">Idle</span>
            <span id="runDoneLine">done: 0 / 0</span>
          </div>
        </div>

        <div class="metric">
          <b>Endpoint</b>
          <div class="summary-sub" style="margin-top:0;">
            <span>Responses</span><span id="mSent">-</span>
          </div>
          <div class="summary-sub" style="margin-top:4px;">
            <span>Endpoint failures</span><span id="mCurlFail">-</span>
          </div>
        </div>

        <!-- Live output removed (v4.8.7): progress + summary is enough -->
      </div>

      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <!-- Add modal -->
  <div class="modal" id="addModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Add target">
      <div class="modal-head">
        <div class="modal-title">
          <b>Add target</b>
          <span>Ping target, then call endpoint on success</span>
        </div>
        <div class="modal-actions"></div>
      </div>

      <div class="modal-body">
        <form id="addForm">
          <div class="grid3">
            <div class="field">
              <label>Name</label>
              <input class="input" name="name" placeholder="e.g. anl-0161-core-gw" required>
            </div>
            <div class="field">
              <label>IP address</label>
              <input class="input" name="ip" placeholder="e.g. 10.5.0.1" required>
            </div>
            <div class="field">
              <label>Interval (sec)</label>
              <input class="input" name="interval" type="number" min="10" max="86400" step="1" placeholder="60" required>
            </div>
          </div>

          <div class="field" style="margin-top:12px;">
            <label>Endpoint URL</label>
            <input class="input" name="endpoint" placeholder="https://..." required>
          </div>

          <div class="modal-foot-actions">
            <button class="btn btn-primary" type="submit" id="btnAddSubmit">Add target</button>
            <button class="btn btn-ghost" type="button" id="btnAddCancel">Cancel</button>
          </div>
        </form>
      </div>

      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <!-- Confirm remove modal -->
  <div class="modal" id="confirmModal" aria-hidden="true">
    <div class="modal-card small" role="dialog" aria-modal="true" aria-label="Confirm remove">
      <div class="modal-head">
        <div class="modal-title">
          <b>Confirm remove</b>
          <span>This cannot be undone</span>
        </div>
        <div class="modal-actions">
          <button class="btn btn-ghost btn-mini" id="btnCloseConfirm" type="button">Close</button>
        </div>
      </div>

      <div class="modal-body">
        <div class="danger-box">
          You are about to remove:
          <div style="margin-top:8px;">
            <code id="confirmName" class="mono"></code>
          </div>
        </div>

        <div class="modal-foot-actions" style="margin-top:14px;">
          <button class="btn btn-danger" id="btnConfirmRemove" type="button">Remove</button>
          <button class="btn btn-ghost" id="btnCancelRemove" type="button">Cancel</button>
        </div>
      </div>

      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <!-- Info modal -->
  <div class="modal" id="infoModal" aria-hidden="true">
    <div class="modal-card small" role="dialog" aria-modal="true" aria-label="Target information">
      <div class="modal-head">
        <div class="modal-title">
          <b>Target information</b>
          <span id="infoTitle">-</span>
        </div>
        <div class="modal-actions">
          <button class="btn btn-ghost btn-mini" id="btnCloseInfo" type="button">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="info-grid">
          <div class="metric">
            <b>Basics</b>
            <div class="kv"><span>Name</span><code id="infoName">-</code></div>
            <div class="kv"><span>IP</span><code id="infoIp">-</code></div>
            <div class="kv"><span>Enabled</span><code id="infoEnabled">-</code></div>
            <div class="kv"><span>Interval</span><code id="infoInterval">-</code></div>
          </div>

          <div class="metric">
            <b>Endpoint</b>
            <div class="kv"><span>URL</span><code id="infoEndpoint" style="word-break:break-all;">-</code></div>
            <div class="hint" id="infoEndpointHint" style="margin-top:8px;">Shown as stored in interheart</div>
          </div>

          <div class="metric">
            <b>Live status</b>
            <div class="kv"><span>Status</span><code id="infoStatus">-</code></div>
            <div class="kv"><span>Last ping</span><code id="infoLastPing">-</code></div>
            <div class="kv"><span>Last response</span><code id="infoLastResp">-</code></div>
            <div class="kv"><span>Latency</span><code id="infoLatency">-</code></div>
          </div>
        </div>

        <div class="metric">
          <b>Uptime (history samples)</b>
          <div class="uptime-wrap" id="uptimeWrap">
            <div class="uptime-row"><span>24h</span><div class="bar"><div id="u24"></div></div><code id="u24t">-</code></div>
            <div class="uptime-row"><span>7d</span><div class="bar"><div id="u7"></div></div><code id="u7t">-</code></div>
            <div class="uptime-row"><span>30d</span><div class="bar"><div id="u30"></div></div><code id="u30t">-</code></div>
            <div class="uptime-row"><span>90d</span><div class="bar"><div id="u90"></div></div><code id="u90t">-</code></div>
          </div>
          <div class="hint" style="margin-top:10px;">Uptime is calculated from samples recorded when interheart runs or when you click Test.</div>
        </div>
      </div>
      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <!-- Edit modal -->
  <div class="modal" id="editModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Edit target">
      <div class="modal-head">
        <div class="modal-title">
          <b>Edit target</b>
          <span id="editTitle">-</span>
        </div>
        <div class="modal-actions">
          <!-- Close removed: Cancel is enough -->
        </div>
      </div>
      <div class="modal-body">
        <form id="editForm">
          <input type="hidden" name="old_name" id="editOldName">
          <input type="hidden" name="enabled" id="editEnabled" value="1">
          <div class="grid3">
            <div class="field">
              <label>Name</label>
              <input class="input" name="new_name" id="editName" required>
            </div>
            <div class="field">
              <label>IP address</label>
              <input class="input" name="ip" id="editIp" required>
            </div>
            <div class="field">
              <label>Interval (sec)</label>
              <input class="input" name="interval" id="editInterval" type="number" min="10" max="86400" step="1" required>
            </div>
          </div>

          <div class="field" style="margin-top:12px;">
            <label>Endpoint URL</label>
            <input class="input" name="endpoint" id="editEndpoint" required>
          </div>

          <div class="modal-foot-actions modal-foot-actions--split">
            <div class="left">
              <button class="btn btn-ghost" type="button" id="btnEditEnable">Enable</button>
              <button class="btn btn-ghost" type="button" id="btnEditDisable">Disable</button>
            </div>
            <div class="right">
              <button class="btn btn-primary" type="submit" id="btnEditSubmit">Save</button>
              <button class="btn btn-ghost" type="button" id="btnEditCancel">Cancel</button>
            </div>
          </div>
        </form>
      </div>
      <div class="footer footer--modal">
        <div class="hint">interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="title">interheart <span class="badge">targets</span></div>
        <div class="subtitle">Powered by <a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a></div>
      </div>

      <div class="right-actions">
        <input id="filterInput" class="input input--sm" placeholder="Filter targets… (name / ip / status)">
        <button class="btn btn-ghost btn-mini" id="openLogs" type="button">Logs</button>
        <button class="btn btn-ghost btn-mini" id="openAdd" type="button">Add</button>
        <button class="btn btn-primary btn-mini" id="btnRunNow" type="button">Run now</button>
      </div>
    </div>

    <div class="card">
      <div class="hint">“Last ping” / “Last response” updates live ({{ poll_seconds }}s refresh)</div>
      <div class="sep"></div>

      <table id="targetsTable">
        <thead>
          <tr>
            <th style="width: 260px;">Name</th>
            <th style="width: 160px;">IP</th>
            <th style="width: 150px;">Status</th>
            <th style="width: 170px;">Interval</th>
            <th style="width: 220px;">Last ping</th>
            <th style="width: 220px;">Last response</th>
            <th style="width: 120px; text-align:right;">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for t in targets %}
          <tr data-name="{{ t.name }}" data-ip="{{ t.ip }}" data-status="{{ t.status }}" data-enabled="{{ t.enabled }}"
              data-last-ping="{{ t.last_ping_epoch }}" data-last-resp="{{ t.last_response_epoch }}">
            <td><code>{{ t.name }}</code></td>
            <td><code>{{ t.ip }}</code></td>
            <td>
              <span class="chip status-chip {% if t.status == 'up' %}status-up{% elif t.status == 'down' %}status-down{% else %}status-unknown{% endif %}">
                <span class="dot"></span>
                <span class="status-text">{{ t.status }}</span>
              </span>
            </td>
            <td>
              <div class="interval-wrap">
                <input class="interval-input" data-interval="{{ t.interval }}" value="{{ t.interval }}" inputmode="numeric" />
                <span class="interval-suffix">s</span>
              </div>
            </td>
            <td><code class="last-ping">{{ t.last_ping_human }}</code></td>
            <td><code class="last-resp">{{ t.last_response_human }}</code></td>
            <td style="text-align:right;">
              <div class="menu">
                <button class="btn btn-ghost btn-mini menu-btn" type="button" aria-label="Actions">⋯</button>
                <div class="menu-dd" role="menu">
                  <button class="menu-item" data-action="info" type="button">Information</button>
                  <button class="menu-item" data-action="edit" type="button">Edit</button>
                  <div class="menu-sep"></div>
                  <button class="menu-item" data-action="enable" type="button">Enable</button>
                  <button class="menu-item" data-action="disable" type="button">Disable</button>
                  <div class="menu-sep"></div>
                  <button class="menu-item" data-action="test" type="button">Test</button>
                  <button class="menu-item danger" data-action="remove" type="button">Remove</button>
                </div>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <div class="footer">
        <div class="hint">WebUI: <code>{{ bind_host }}:{{ bind_port }}</code> • interheart <code>{{ ui_version }}</code></div>
        <div><a href="https://5echo.io" target="_blank" rel="noreferrer">5echo.io</a> © {{ copyright_year }} All rights reserved</div>
      </div>
    </div>
  </div>

  <script src="/static/app.js?v={{ ui_version }}"></script>
</body>
</html>
